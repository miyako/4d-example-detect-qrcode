<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">
                <title>DEMO</title>
                <link href="/css/bootstrap.min.css" rel="stylesheet" />
            </head>
    <body>
        <div class="col-auto">
            <label for="fileInput1" class="visually-hidden"></label>
            <input class="form-control" id="fileInput1" type="file" accept="image/*;capture=camera" />
        </div>
        <div class="col-auto">
            <label for="textValue1" class="visually-hidden"></label>
            <input type="text" class="form-control" id="textValue1" disabled />
        </div>
        <button id="sendButton1" data-target="textValue1" type="button" class="btn btn-primary disabled">Send</button>
        <script src="/js/jquery.js"></script>
        <script>
            var app = (function($){
                const credentials = {
                    username:'guest',
                    password:'tseug'
                };
                const headers = {
                    'username-4D':credentials.username,
                    'password-4D':credentials.password
                };
                const $textValue1 = $("#textValue1");
                const $fileInput1 = $("#fileInput1");
                const $sendButton1 = $("#sendButton1");
                var app = {
                    login:function(){
                        // Make a request for a user with a given ID
                        axios.post('/rest/$directory/login', {}, {headers:headers})
                        .then(function (response) {
                            console.log(response);
                        })
                        .catch(function (error) {
                            console.log(error);
                        })
                        .finally(function () {
                            // always executed
                        });
                    },
                    send:function(value, origin, target){
                        axios.post('/rest/$catalog/send', [value, origin, target], {headers:headers})
                        .then(function (response) {
                            $('#'+response.data.result.target).val(response.data.result.message);
                            console.log(response);
                            app.logout();
                        })
                        .catch(function (error) {
                            console.log(error);
                        })
                        .finally(function () {
                            // always executed
                        });
                    },
                    logout:function(){
                        axios.post('/rest/$catalog/logout', null, {headers:headers})
                        .then(function (response) {
                            console.log(response);
                        })
                        .catch(function (error) {
                            console.log(error);
                        })
                        .finally(function () {
                            //
                        });
                    },
                    scan:function() {
                        const detector = new BarcodeDetector({ formats: ['qr_code'] });
                    }
                };
                $sendButton1.on('click', function(e){
                    debugger;
                    app.send($textValue1.val(), this.id, this.getAttribute('data-target'));
                });
                
                $fileInput1.on('change', function(e){
                    
                    $textValue1.val("");
                    
                    if(this.files.length != 0) {
                        let source = this.files[0];
                        const detector = new BarcodeDetector({ formats: ['qr_code']});
                        detector.detect(source)
                        .then(function (response) {
                            if(response.length > 0){
                                $textValue1.val(response[0].rawValue);
                                $sendButton1.removeClass("disabled");
                            }else{
                                $textValue1.val("barcode not detected");
                                $sendButton1.addClass("disabled");
                            }
                        })
                        .catch(function (error) {
                            $textValue1.val("ERROR");
                            $sendButton1.addClass("disabled");
                        })
                        .finally(function () {
                            //
                        });
                    }
                    
                });
                
                return app;
            })(jQuery);
        </script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/js/axios.min.js"></script>
        <script src="/js/zbar-wasm.js"></script>
        <script src="/js/barcode-detector-polyfill.js"></script>
        <script src="/js/jsQR.js"></script>
        <script>
            try {
                window['BarcodeDetector'].getSupportedFormats()
            } catch {
                window['BarcodeDetector'] = barcodeDetectorPolyfill.BarcodeDetectorPolyfill
            }
        </script>
    </body>
</html>
